<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EV Charge Alert UK</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #dbeafe 0%, #d1fae5 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            padding: 40px;
            max-width: 500px;
            width: 100%;
        }
        h1 {
            color: #1f2937;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .subtitle {
            color: #6b7280;
            margin-bottom: 32px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }
        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
        }
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #16a34a;
        }
        button {
            width: 100%;
            padding: 14px;
            background: #16a34a;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }
        button:hover {
            background: #15803d;
        }
        .status {
            margin-top: 20px;
            padding: 12px;
            border-radius: 8px;
            display: none;
        }
        .status.success {
            background: #dcfce7;
            color: #166534;
            display: block;
        }
        .status.error {
            background: #fee2e2;
            color: #991b1b;
            display: block;
        }
        .info {
            background: #dbeafe;
            padding: 16px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 14px;
            color: #1e40af;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚ö° EV Charge Alert</h1>
        <p class="subtitle">Report a blocked charging station</p>

        <form id="reportForm">
            <div class="form-group">
                <label>Upload Photo of License Plate</label>
                <input type="file" id="imageFile" accept="image/*" style="display:none;">
<button type="button" onclick="takePhoto()" style="width: 100%; background: #3b82f6; margin-bottom: 10px;">üì∑ Take Photo</button>
<button type="button" onclick="choosePhoto()" style="width: 100%; background: #6b7280; margin-bottom: 10px;">üñºÔ∏è Choose from Gallery</button>
<img id="preview" style="max-width: 100%; border-radius: 8px; margin-top: 10px; display: none;">
            </div>

            <div class="form-group">
                <label>Charger ID</label>
                <input type="text" id="chargerId" placeholder="e.g., CHG-001" required>
            </div>

            <div class="form-group">
                <label>Location</label>
                <input type="text" id="location" placeholder="e.g., Tesco Extra, High Street" required>
            </div>

            <button type="submit">üì∏ Report Blocked Charger</button>
        </form>

        <div id="status" class="status"></div>

        <div class="info">
            <strong>‚ÑπÔ∏è How it works:</strong><br>
            1. Take a photo of the blocking vehicle's license plate<br>
            2. Enter the charger location<br>
            3. We'll notify the vehicle owner to move
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <script>
       // Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyAuUjDPCCyU3m_5PNX45s2xE-6KSSNJBqM",
  authDomain: "ev-alert-web.firebaseapp.com",
  projectId: "ev-alert-web",
  storageBucket: "ev-alert-web.firebasestorage.app",
  messagingSenderId: "1046302695642",
  appId: "1:1046302695642:web:e9f9b75d7126a7e26d05e3"
};

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const storage = firebase.storage();
        const db = firebase.firestore();

        // Form submission
        document.getElementById('reportForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const statusDiv = document.getElementById('status');
            statusDiv.className = 'status';
            statusDiv.textContent = '‚è≥ Uploading image...';
            statusDiv.style.display = 'block';

            try {
                // Get form data
                const imageFile = document.getElementById('imageFile').files[0];
                const chargerId = document.getElementById('chargerId').value;
                const location = document.getElementById('location').value;

                // Upload image to Firebase Storage
                const timestamp = Date.now();
                const storageRef = storage.ref(`charger-reports/${timestamp}-${imageFile.name}`);
                const uploadTask = await storageRef.put(imageFile);

                // Get gs:// URL
                const gsUrl = `gs://${uploadTask.ref.bucket}/${uploadTask.ref.fullPath}`;

                statusDiv.textContent = 'üìù Creating report...';

                // Create Firestore document (this triggers your Cloud Function!)
                await db.collection('chargerUsage').add({
                    imageUrl: gsUrl,
                    chargerId: chargerId,
                    location: location,
                    reportedBy: 'web_user',
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });

                // Success!
                statusDiv.className = 'status success';
                statusDiv.textContent = '‚úÖ Report submitted! The vehicle owner will be notified.';

                // Reset form
                document.getElementById('reportForm').reset();

            } catch (error) {
                console.error('Error:', error);
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ùå Error: ' + error.message;
            }
        });
        let selectedImage = null;

// Take photo with camera
async function takePhoto() {
    try {
        // Check if running in Capacitor (mobile)
        if (typeof Capacitor !== 'undefined') {
            const { Camera } = await import('@capacitor/camera');
            
            const image = await Camera.getPhoto({
                quality: 90,
                allowEditing: false,
                resultType: Camera.CameraResultType.Uri,
                source: Camera.CameraSource.Camera
            });
            
            selectedImage = await fetch(image.webPath).then(r => r.blob());
            document.getElementById('preview').src = image.webPath;
            document.getElementById('preview').style.display = 'block';
            
        } else {
            // Fallback for web
            document.getElementById('imageFile').click();
        }
    } catch (error) {
        alert('Error taking photo: ' + error.message);
    }
}

// Choose photo from gallery
async function choosePhoto() {
    try {
        if (typeof Capacitor !== 'undefined') {
            const { Camera } = await import('@capacitor/camera');
            
            const image = await Camera.getPhoto({
                quality: 90,
                allowEditing: false,
                resultType: Camera.CameraResultType.Uri,
                source: Camera.CameraSource.Photos
            });
            
            selectedImage = await fetch(image.webPath).then(r => r.blob());
            document.getElementById('preview').src = image.webPath;
            document.getElementById('preview').style.display = 'block';
            
        } else {
            document.getElementById('imageFile').click();
        }
    } catch (error) {
        alert('Error choosing photo: ' + error.message);
    }
}

// Update form submission to use selectedImage
document.getElementById('reportForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const statusDiv = document.getElementById('status');
    statusDiv.className = 'status';
    statusDiv.textContent = '‚è≥ Uploading image...';
    statusDiv.style.display = 'block';

    try {
        // Use selectedImage from camera or file input
        const imageFile = selectedImage || document.getElementById('imageFile').files[0];
        
        if (!imageFile) {
            throw new Error('Please take or select a photo first');
        }
        
        const chargerId = document.getElementById('chargerId').value;
        const location = document.getElementById('location').value;

        // Upload image to Firebase Storage
        const timestamp = Date.now();
        const storageRef = storage.ref(`charger-reports/${timestamp}.jpg`);
        const uploadTask = await storageRef.put(imageFile);

        // Get gs:// URL
        const gsUrl = `gs://${uploadTask.ref.bucket}/${uploadTask.ref.fullPath}`;

        statusDiv.textContent = 'üìù Creating report...';

        // Create Firestore document
        await db.collection('chargerUsage').add({
            imageUrl: gsUrl,
            chargerId: chargerId,
            location: location,
            reportedBy: 'mobile_user',
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });

        // Success!
        statusDiv.className = 'status success';
        statusDiv.textContent = '‚úÖ Report submitted! The vehicle owner will be notified.';

        // Reset form
        document.getElementById('reportForm').reset();
        document.getElementById('preview').style.display = 'none';
        selectedImage = null;

    } catch (error) {
        console.error('Error:', error);
        statusDiv.className = 'status error';
        statusDiv.textContent = '‚ùå Error: ' + error.message;
    }
});
    </script>
</body>
</html>
